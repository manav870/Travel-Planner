{% extends 'base.html' %}

{% block title %}{{ destination.name }} - Travel Planner{% endblock %}

{% block content %}
<!-- Destination Header -->
<div class="destination-header mb-5">
    <div class="destination-image" style="background-image: url('https://source.unsplash.com/1200x400/?{{ destination.name }},travel');">
        <div class="destination-overlay">
            <div class="container">
                <div class="destination-title">
                    <h1>{{ destination.name }}</h1>
                    <div class="destination-meta">
                        <span><i class="fas fa-map-marker-alt me-2"></i>{{ destination.country }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Description -->
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="card-title">About {{ destination.name }}</h2>
                    <p class="lead">{{ destination.description }}</p>
                    <p>{{ destination.name }} is a destination that offers a perfect blend of culture, history, and modern attractions. Whether you're looking for adventure, relaxation, or cultural experiences, this city has something for everyone.</p>
                </div>
            </div>
            
            <!-- Weather Widget -->
            <div class="weather-widget mb-4">
                <div class="weather-card">
                    <div class="weather-loading">
                        <div class="spinner-border text-light" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    <div class="weather-data d-none">
                        <div class="weather-header">
                            <h5><i class="fas fa-map-marker-alt me-2"></i><span class="weather-city"></span></h5>
                            <div class="weather-time">
                                <i class="far fa-clock me-1"></i><span id="current-time"></span>
                            </div>
                        </div>
                        
                        <div class="weather-main">
                            <div class="weather-icon-container">
                                <img src="" alt="Weather icon" class="weather-icon">
                            </div>
                            <div class="weather-info">
                                <div class="weather-temperature"></div>
                                <div class="weather-description"></div>
                            </div>
                        </div>
                        
                        <div class="weather-details">
                            <div class="weather-detail">
                                <div class="detail-icon">
                                    <i class="fas fa-temperature-high"></i>
                                </div>
                                <div class="detail-info">
                                    <div class="detail-label">Feels like</div>
                                    <div class="detail-value feels-like"></div>
                                </div>
                            </div>
                            
                            <div class="weather-detail">
                                <div class="detail-icon">
                                    <i class="fas fa-tint"></i>
                                </div>
                                <div class="detail-info">
                                    <div class="detail-label">Humidity</div>
                                    <div class="detail-value humidity"></div>
                                </div>
                            </div>
                            
                            <div class="weather-detail">
                                <div class="detail-icon">
                                    <i class="fas fa-wind"></i>
                                </div>
                                <div class="detail-info">
                                    <div class="detail-label">Wind</div>
                                    <div class="detail-value wind-speed"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="weather-footer">
                            <i class="fas fa-sync-alt me-1"></i> Updated just now
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Attractions -->
            <div class="attractions-widget mb-4">
                <div class="attractions-card">
                    <div class="attractions-header">
                        <h5><i class="fas fa-map-marked-alt me-2"></i>Top Attractions</h5>
                    </div>
                    
                    <div class="attractions-content">
                        <div class="row">
                            {% for attraction in destination.attractions %}
                            <div class="col-md-6 mb-3">
                                <div class="attraction-item">
                                    <div class="attraction-icon">
                                        <i class="fas fa-landmark"></i>
                                    </div>
                                    <div class="attraction-content">
                                        <h5>{{ attraction }}</h5>
                                        <p>A must-visit attraction in {{ destination.name }}.</p>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Travel Tips -->
            <div class="tips-widget mb-4">
                <div class="tips-card">
                    <div class="tips-header">
                        <h5><i class="fas fa-lightbulb me-2"></i>Travel Tips</h5>
                    </div>
                    
                    <div class="tips-content">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="tip-item">
                                    <div class="tip-icon">
                                        <i class="fas fa-calendar-alt"></i>
                                    </div>
                                    <div class="tip-info">
                                        <div class="tip-label">Best Time to Visit</div>
                                        <div class="tip-value">Spring and Fall</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="tip-item">
                                    <div class="tip-icon">
                                        <i class="fas fa-language"></i>
                                    </div>
                                    <div class="tip-info">
                                        <div class="tip-label">Language</div>
                                        <div class="tip-value">Learn basic local phrases</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="tip-item">
                                    <div class="tip-icon">
                                        <i class="fas fa-money-bill-wave"></i>
                                    </div>
                                    <div class="tip-info">
                                        <div class="tip-label">Currency</div>
                                        <div class="tip-value">Check exchange rates before travel</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="tip-item">
                                    <div class="tip-icon">
                                        <i class="fas fa-utensils"></i>
                                    </div>
                                    <div class="tip-info">
                                        <div class="tip-label">Food</div>
                                        <div class="tip-value">Try local cuisine for authentic experience</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Action Card -->
            <div class="card mb-4 action-card">
                <div class="card-body text-center">
                    <h4 class="mb-4">Ready to explore {{ destination.name }}?</h4>
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('plan_trip') }}" class="btn btn-primary btn-lg">
                            <i class="fas fa-plane-departure me-2"></i>Plan a Trip
                        </a>
                        <a href="{{ url_for('home') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Destinations
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Map Card (Placeholder) -->
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0"><i class="fas fa-map me-2"></i>Location</h4>
                </div>
                <div class="card-body p-0">
                    <img src="https://maps.googleapis.com/maps/api/staticmap?center={{ destination.name }},{{ destination.country }}&zoom=10&size=400x300&key=YOUR_API_KEY" 
                         class="img-fluid" alt="Map of {{ destination.name }}"
                         onerror="this.src='https://via.placeholder.com/400x300?text=Map+of+{{ destination.name }}'">
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .destination-header {
        position: relative;
    }
    
    .destination-image {
        height: 400px;
        background-size: cover;
        background-position: center;
        border-radius: var(--radius-lg);
        overflow: hidden;
    }
    
    .destination-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.7));
        display: flex;
        align-items: flex-end;
        padding-bottom: 2rem;
    }
    
    .destination-title {
        color: white;
    }
    
    .destination-title h1 {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    
    .destination-meta {
        font-size: 1.25rem;
    }
    
    /* Attractions Widget Styles */
    .attractions-widget {
        margin: 0;
        padding: 0;
    }
    
    .attractions-card {
        position: relative;
        border-radius: 20px;
        overflow: hidden;
        background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);
        box-shadow: 0 15px 30px rgba(67, 206, 162, 0.25);
        color: white;
        padding: 1.5rem;
        transition: all 0.3s ease;
    }
    
    .attractions-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(67, 206, 162, 0.3);
    }
    
    .attractions-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .attractions-header h5 {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0;
    }
    
    .attractions-content {
        padding: 0.5rem;
    }
    
    .attraction-item {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        padding: 1rem;
        display: flex;
        align-items: center;
        margin-bottom: 0.5rem;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        transition: all 0.3s ease;
    }
    
    .attraction-item:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-3px);
    }
    
    .attraction-icon {
        background: rgba(255, 255, 255, 0.3);
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        margin-right: 1rem;
    }
    
    .attraction-content {
        flex: 1;
    }
    
    .attraction-content h5 {
        margin-bottom: 0.25rem;
        font-weight: 600;
    }
    
    .attraction-content p {
        margin-bottom: 0;
        font-size: 0.9rem;
        opacity: 0.9;
    }
    
    /* Travel Tips Widget Styles */
    .tips-widget {
        margin: 0;
        padding: 0;
    }
    
    .tips-card {
        position: relative;
        border-radius: 20px;
        overflow: hidden;
        background: linear-gradient(135deg, #FF9966 0%, #FF5E62 100%);
        box-shadow: 0 15px 30px rgba(255, 94, 98, 0.25);
        color: white;
        padding: 1.5rem;
        transition: all 0.3s ease;
    }
    
    .tips-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(255, 94, 98, 0.3);
    }
    
    .tips-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .tips-header h5 {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0;
    }
    
    .tips-content {
        padding: 0.5rem;
    }
    
    .tip-item {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        padding: 1rem;
        display: flex;
        align-items: center;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        height: 100%;
    }
    
    .tip-item:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-3px);
    }
    
    .tip-icon {
        background: rgba(255, 255, 255, 0.3);
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        font-size: 1.25rem;
    }
    
    .tip-info {
        flex: 1;
    }
    
    .tip-label {
        font-size: 0.85rem;
        opacity: 0.9;
        margin-bottom: 0.25rem;
        font-weight: 600;
    }
    
    .tip-value {
        font-size: 0.95rem;
    }
    
    .action-card {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
    }
    
    .action-card .btn-outline-secondary {
        color: white;
        border-color: white;
    }
    
    .action-card .btn-outline-secondary:hover {
        background-color: white;
        color: var(--primary-color);
    }
    
    @media (max-width: 768px) {
        .destination-image {
            height: 300px;
        }
        
        .destination-title h1 {
            font-size: 2.25rem;
        }
    }
    
    /* Modern Weather Widget Styles */
    .weather-widget {
        margin: 0;
        padding: 0;
    }
    
    .weather-card {
        position: relative;
        border-radius: 20px;
        overflow: hidden;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        box-shadow: 0 15px 30px rgba(102, 126, 234, 0.25);
        color: white;
        padding: 1.5rem;
        transition: all 0.3s ease;
    }
    
    .weather-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
    }
    
    .weather-loading {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 200px;
    }
    
    .weather-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .weather-header h5 {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0;
    }
    
    .weather-time {
        font-size: 0.9rem;
        opacity: 0.9;
    }
    
    .weather-main {
        display: flex;
        align-items: center;
        margin-bottom: 2rem;
    }
    
    .weather-icon-container {
        position: relative;
        margin-right: 1.5rem;
    }
    
    .weather-icon {
        width: 90px;
        height: 90px;
        filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.1));
        animation: pulse 2s infinite ease-in-out;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    
    .weather-info {
        flex: 1;
    }
    
    .weather-temperature {
        font-size: 3.5rem;
        font-weight: 700;
        line-height: 1;
        margin-bottom: 0.5rem;
    }
    
    .weather-description {
        font-size: 1.25rem;
        text-transform: capitalize;
        opacity: 0.9;
    }
    
    .weather-details {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .weather-detail {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        padding: 1rem;
        display: flex;
        align-items: center;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        transition: all 0.3s ease;
    }
    
    .weather-detail:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-3px);
    }
    
    .detail-icon {
        background: rgba(255, 255, 255, 0.3);
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        font-size: 1.25rem;
    }
    
    .detail-info {
        flex: 1;
    }
    
    .detail-label {
        font-size: 0.85rem;
        opacity: 0.9;
        margin-bottom: 0.25rem;
    }
    
    .detail-value {
        font-weight: 600;
        font-size: 1.1rem;
    }
    
    .weather-footer {
        text-align: right;
        font-size: 0.85rem;
        opacity: 0.8;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .weather-details {
            grid-template-columns: 1fr;
        }
        
        .weather-main {
            flex-direction: column;
            text-align: center;
        }
        
        .weather-icon-container {
            margin-right: 0;
            margin-bottom: 1rem;
        }
    }
    
    .budget-range {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 1rem 0;
    }
    
    .badge {
        font-size: 1.1rem;
        padding: 0.5rem 1rem;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    var destinationId = "{{ destination.id }}";
    var weatherLoading = document.querySelector('.weather-loading');
    var weatherData = document.querySelector('.weather-data');
    
    // Function to update the current time
    function updateCurrentTime() {
        var now = new Date();
        var options = { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true
        };
        document.getElementById('current-time').textContent = now.toLocaleTimeString([], options);
    }
    
    // Update time every minute
    updateCurrentTime();
    setInterval(updateCurrentTime, 60000);
    
    // Function to update weather display
    function updateWeatherDisplay(data) {
        // Update city name
        document.querySelector('.weather-city').textContent = data.city + ', ' + data.country;
        
        // Update weather icon - WeatherAPI.com provides full URLs to icons
        var weatherIcon = document.querySelector('.weather-icon');
        weatherIcon.src = data.icon.startsWith('http') ? data.icon : 'https://openweathermap.org/img/wn/' + data.icon + '@2x.png';
        
        // Update temperature and description
        document.querySelector('.weather-temperature').textContent = data.temperature + '°C';
        document.querySelector('.weather-description').textContent = data.description;
        
        // Update additional details
        document.querySelector('.feels-like').textContent = data.feels_like + '°C';
        document.querySelector('.humidity').textContent = data.humidity + '%';
        document.querySelector('.wind-speed').textContent = data.wind_speed + ' m/s';
        
        // Show weather data and hide loading
        weatherLoading.classList.add('d-none');
        weatherData.classList.remove('d-none');
        
        // Update footer with current time
        var now = new Date();
        var options = { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true
        };
        document.querySelector('.weather-footer').innerHTML = 
            '<i class="fas fa-sync-alt me-1"></i> Updated at ' + 
            now.toLocaleTimeString([], options);
    }
    
    // Function to fetch weather data
    function fetchWeather() {
        fetch('/api/weather/' + destinationId)
            .then(function(response) {
                if (!response.ok) {
                    throw new Error('Failed to fetch weather data');
                }
                return response.json();
            })
            .then(function(data) {
                updateWeatherDisplay(data);
            })
            .catch(function(error) {
                console.error('Error fetching weather:', error);
                weatherLoading.innerHTML = '<div class="alert alert-danger">Failed to load weather data</div>';
                weatherData.classList.add('d-none');
            });
    }
    
    // Fetch weather data immediately
    fetchWeather();
    
    // Refresh weather data every 30 minutes
    setInterval(fetchWeather, 30 * 60 * 1000);
});
</script>
{% endblock %} 